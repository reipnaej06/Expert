<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Service Expert - Formulario Inteligente</title>
  <style>
    /* Estilos base (conservando tu diseño Apple) */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      background-color: #f5f7fa;
      color: #1d1d1f;
    }
    
    /* Página de bienvenida (igual a tu versión) */
    #welcomePage {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(160deg, #f5f5f7 0%, #ffffff 100%);
      color: #1d1d1f;
      z-index: 1000;
      padding: 20px;
      text-align: center;
    }
    
    .welcome-content {
      max-width: 600px;
      padding: 40px;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 18px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    /* Contenedor principal de etapas */
    #formStages {
      display: none;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Barra de progreso */
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      position: relative;
    }
    
    .progress-step {
      width: 36px;
      height: 36px;
      background-color: #e0e0e0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-weight: 600;
      z-index: 2;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    
    .progress-step.active {
      background-color: #0071e3;
      color: white;
      border-color: #0071e3;
    }
    
    .progress-step.completed {
      background-color: #34c759;
      color: white;
      border-color: #34c759;
    }
    
    .progress-line {
      position: absolute;
      top: 18px;
      left: 0;
      height: 4px;
      background-color: #e0e0e0;
      width: 100%;
      z-index: 1;
    }
    
    .progress-line-fill {
      height: 100%;
      background-color: #0071e3;
      width: 0%;
      transition: width 0.3s ease;
    }
    
    /* Etapas del formulario */
    .form-stage {
      display: none;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
    }
    
    .form-stage.active {
      display: block;
    }
    
    .form-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      font-weight: 600;
      color: #1d1d1f;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #1d1d1f;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #d2d2d7;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: #0071e3;
      outline: none;
    }
    
    /* Botones de navegación */
    .form-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }
    
    .form-button {
      padding: 12px 25px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background-color: #0071e3;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #0077ed;
    }
    
    .btn-secondary {
      background-color: transparent;
      color: #0071e3;
      border: 1px solid #0071e3;
    }
    
    .btn-secondary:hover {
      background-color: rgba(0, 113, 227, 0.1);
    }
    
    /* Pantalla de PDF */
    #pdfStage {
      display: none;
      flex-direction: column;
      height: 100vh;
    }
    
    .pdf-header {
      background-color: #f5f5f7;
      color: #1d1d1f;
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid #d2d2d7;
    }
    
    .iframe-container {
      flex: 1;
      width: 100%;
      height: calc(100vh - 120px);
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .action-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #f5f5f7;
      padding: 15px;
      display: flex;
      justify-content: center;
      gap: 15px;
      border-top: 1px solid #d2d2d7;
    }
    
    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
  </style>
</head>
<body>
  <!-- Página de bienvenida -->
  <div id="welcomePage">
    <div class="welcome-content">
      <h1 class="welcome-title">Bienvenido al Formulario</h1>
      <p class="welcome-text">
        Complete el siguiente formulario en simples pasos para agilizar su solicitud de servicio.
      </p>
      <button class="next-button" onclick="startForm()">Comenzar</button>
    </div>
  </div>

  <!-- Contenedor de etapas del formulario -->
  <div id="formStages">
    <!-- Barra de progreso -->
    <div class="progress-bar">
      <div class="progress-line">
        <div class="progress-line-fill" id="progressFill"></div>
      </div>
      <div class="progress-step active" id="step1Indicator">1</div>
      <div class="progress-step" id="step2Indicator">2</div>
      <div class="progress-step" id="step3Indicator">✓</div>
    </div>

    <!-- Etapa 1: Información del usuario -->
    <div class="form-stage active" id="stage1">
      <h2 class="form-title">Información Personal</h2>
      
      <div class="form-group">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" required>
      </div>
      
      <div class="form-group">
        <label for="apellidos">Apellidos:</label>
        <input type="text" id="apellidos" required>
      </div>
      
      <div class="form-group">
        <label for="dni">DNI:</label>
        <input type="text" id="dni" required>
      </div>
      
      <div class="form-group">
        <label for="fechaNacimiento">Fecha de Nacimiento:</label>
        <input type="date" id="fechaNacimiento" required>
      </div>
      
      <div class="form-group">
        <label for="telefono">Teléfono:</label>
        <input type="tel" id="telefono" required>
      </div>
      
      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" required>
      </div>
      
      <div class="form-group">
        <label for="direccion">Dirección:</label>
        <input type="text" id="direccion" required>
      </div>
      
      <div class="form-navigation">
        <button class="form-button btn-primary" onclick="nextStage()">Siguiente</button>
      </div>
    </div>

    <!-- Etapa 2: Dispositivo a configurar -->
    <div class="form-stage" id="stage2">
      <h2 class="form-title">Dispositivo a Configurar</h2>
      
      <div class="form-group">
        <label for="servicio">Tipo de Servicio:</label>
        <select id="servicio" required>
          <option value="">Seleccione...</option>
          <option value="Pase de información">Pase de información</option>
          <option value="Restauración">Restauración</option>
          <option value="Reinicio">Reinicio</option>
          <option value="Mantenimiento">Mantenimiento</option>
          <option value="Otro">Otro</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="dispositivo">Dispositivo:</label>
        <input type="text" id="dispositivo" placeholder="Ej: iPhone 13, MacBook Pro" required>
      </div>
      
      <div class="form-group">
        <label for="numeroSerie">Número de Serie/IMEI:</label>
        <input type="text" id="numeroSerie" required>
      </div>
      
      <div class="form-group">
        <label for="condiciones">Condiciones del Dispositivo:</label>
        <select id="condiciones" multiple size="3">
          <option value="Marcas de uso">Marcas de uso</option>
          <option value="Desgaste">Desgaste</option>
          <option value="Golpes">Golpes</option>
          <option value="Pantalla rota">Pantalla rota</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="detalles">Otros detalles/Accesorios:</label>
        <textarea id="detalles" rows="3"></textarea>
      </div>
      
      <div class="form-group">
        <label>¿Posee contraseña de Apple ID?</label>
        <div>
          <input type="radio" id="appleIdSi" name="appleId" value="Si">
          <label for="appleIdSi" style="display: inline; margin-right: 15px;">Sí</label>
          <input type="radio" id="appleIdNo" name="appleId" value="No">
          <label for="appleIdNo" style="display: inline;">No</label>
        </div>
      </div>
      
      <div class="form-navigation">
        <button class="form-button btn-secondary" onclick="prevStage()">Anterior</button>
        <button class="form-button btn-primary" onclick="generatePDF()">Generar PDF</button>
      </div>
    </div>
  </div>

  <!-- Pantalla de PDF -->
  <div id="pdfStage">
    <div class="pdf-header">
      <h1>Formulario Completado</h1>
    </div>
    
    <div class="iframe-container">
      <iframe id="formularioPdf" title="Formulario Service Expert PDF"></iframe>
    </div>
    
    <div class="action-buttons">
      <button class="form-button btn-secondary" onclick="backToForm()">Volver a Editar</button>
      <button class="form-button btn-primary" onclick="printPDF()">Imprimir PDF</button>
    </div>
  </div>

  <script>
    // Datos del formulario
    const formData = {
      usuario: {},
      dispositivo: {}
    };
    
    // Iniciar formulario
    function startForm() {
      document.getElementById('welcomePage').style.animation = 'fadeOut 0.5s ease forwards';
      setTimeout(() => {
        document.getElementById('welcomePage').style.display = 'none';
        document.getElementById('formStages').style.display = 'block';
      }, 500);
    }
    
    // Navegación entre etapas
    let currentStage = 1;
    const totalStages = 2;
    
    function updateProgress() {
      const progressFill = document.getElementById('progressFill');
      const progressPercentage = ((currentStage - 1) / (totalStages - 1)) * 100;
      progressFill.style.width = `${progressPercentage}%`;
      
      // Actualizar indicadores de pasos
      document.getElementById('step1Indicator').classList.toggle('active', currentStage >= 1);
      document.getElementById('step1Indicator').classList.toggle('completed', currentStage > 1);
      
      document.getElementById('step2Indicator').classList.toggle('active', currentStage >= 2);
      document.getElementById('step2Indicator').classList.toggle('completed', currentStage > 2);
      
      document.getElementById('step3Indicator').classList.toggle('active', currentStage >= 3);
    }
    
    function nextStage() {
      if (currentStage === 1) {
        // Validar etapa 1
        if (!validateStage1()) return;
        
        // Guardar datos de la etapa 1
        formData.usuario = {
          nombre: document.getElementById('nombre').value,
          apellidos: document.getElementById('apellidos').value,
          dni: document.getElementById('dni').value,
          fechaNacimiento: document.getElementById('fechaNacimiento').value,
          telefono: document.getElementById('telefono').value,
          email: document.getElementById('email').value,
          direccion: document.getElementById('direccion').value
        };
      }
      
      // Cambiar a la siguiente etapa
      document.getElementById(`stage${currentStage}`).classList.remove('active');
      currentStage++;
      document.getElementById(`stage${currentStage}`).classList.add('active');
      updateProgress();
    }
    
    function prevStage() {
      // Cambiar a la etapa anterior
      document.getElementById(`stage${currentStage}`).classList.remove('active');
      currentStage--;
      document.getElementById(`stage${currentStage}`).classList.add('active');
      updateProgress();
    }
    
    // Validación de la etapa 1
    function validateStage1() {
      const requiredFields = ['nombre', 'apellidos', 'dni', 'fechaNacimiento', 'telefono', 'email', 'direccion'];
      let isValid = true;
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
          field.style.borderColor = '#ff3b30';
          isValid = false;
        } else {
          field.style.borderColor = '#d2d2d7';
        }
      });
      
      if (!isValid) {
        alert('Por favor complete todos los campos requeridos');
      }
      
      return isValid;
    }
    
    // Generar PDF con los datos
    function generatePDF() {
      // Guardar datos de la etapa 2
      formData.dispositivo = {
        servicio: document.getElementById('servicio').value,
        dispositivo: document.getElementById('dispositivo').value,
        numeroSerie: document.getElementById('numeroSerie').value,
        condiciones: Array.from(document.getElementById('condiciones').selectedOptions).map(opt => opt.value).join(', '),
        detalles: document.getElementById('detalles').value,
        appleId: document.querySelector('input[name="appleId"]:checked')?.value || 'No especificado'
      };
      
      // Mostrar pantalla de PDF
      document.getElementById('formStages').style.display = 'none';
      document.getElementById('pdfStage').style.display = 'flex';
      document.getElementById('step3Indicator').classList.add('completed');
      
      // Generar URL del PDF con parámetros
      const pdfUrl = generatePDFUrl();
      document.getElementById('formularioPdf').src = pdfUrl;
    }
    
    // Generar URL del PDF con los datos del formulario
    function generatePDFUrl() {
      const baseUrl = 'Service_Expert_Formulario.pdf';
      const params = new URLSearchParams();
      
      // Agregar datos de usuario
      for (const [key, value] of Object.entries(formData.usuario)) {
        params.append(key, value);
      }
      
      // Agregar datos de dispositivo
      for (const [key, value] of Object.entries(formData.dispositivo)) {
        params.append(key, value);
      }
      
      return `${baseUrl}#${params.toString()}`;
    }
    
    // Volver al formulario desde el PDF
    function backToForm() {
      document.getElementById('pdfStage').style.display = 'none';
      document.getElementById('formStages').style.display = 'block';
    }
    
    // Imprimir PDF
    function printPDF() {
      const pdfWindow = window.open('Service_Expert_Formulario.pdf', '_blank');
      pdfWindow.onload = function() {
        pdfWindow.print();
      };
    }
    
    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
      updateProgress();
    });
  </script>
</body>
</html>
